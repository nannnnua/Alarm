<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•ŒëŒ ì‹œê³„</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    
    th {
      background-color: #f2f2f2;
    }
    
    #alarmModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border: 3px solid red;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      z-index: 1000;
    }

    #editModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border: 2px solid #4CAF50;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      z-index: 1000;
      border-radius: 10px;
    }

    #editModal h2 {
      margin-top: 0;
      color: #4CAF50;
    }

    #editModal input {
      margin: 15px 0;
      font-size: 18px;
    }

    #editModal div {
      margin-top: 20px;
    }
    
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    
    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    
    input {
      padding: 8px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <h1>ì•ŒëŒ ì‹œê³„</h1>
  
  <div>
    <input type="time" id="alarmTime">
    <button onclick="setAlarm()">ì•ŒëŒ ì„¤ì •</button>
  </div>

  <div style="margin-top: 10px;">
    <button onclick="exportToCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
    <input type="file" id="csvFileInput" accept=".csv" style="display:none" onchange="importFromCSV(event)">
    <button onclick="document.getElementById('csvFileInput').click()">CSV ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>ì„¤ì • ì‹œê°„</th>
        <th>í¸ì§‘</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody id="alarmList"></tbody>
  </table>

  <!-- ì•ŒëŒ ëª¨ë‹¬ì°½ -->
  <div id="overlay"></div>
  <div id="alarmModal">
    <h2>ğŸ”” ì•ŒëŒ!</h2>
    <p id="alarmTimeText"></p>
    <button onclick="stopAlarm()">ë„ê¸°</button>
  </div>

  <!-- í¸ì§‘ ëª¨ë‹¬ì°½ -->
  <div id="editModal">
    <h2>ì•ŒëŒ ì‹œê°„ í¸ì§‘</h2>
    <p>ìƒˆë¡œìš´ ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”</p>
    <input type="time" id="editTimeInput">
    <div>
      <button onclick="saveEdit()">ì €ì¥</button>
      <button onclick="cancelEdit()">ì·¨ì†Œ</button>
    </div>
  </div>

  <script>
    let alarms = []; // ì•ŒëŒ ëª©ë¡
    let audioContext = null;
    let oscillator = null;
    let isAlarmRinging = false;
    let editingIndex = -1; // í¸ì§‘ ì¤‘ì¸ ì•ŒëŒì˜ ì¸ë±ìŠ¤

    // ì•ŒëŒ ì„¤ì • í•¨ìˆ˜
    function setAlarm() {
      const timeInput = document.getElementById('alarmTime').value;
      
      if (timeInput) {
        // ì¤‘ë³µ í™•ì¸
        if (alarms.includes(timeInput)) {
          alert('ì´ë¯¸ ì„¤ì •ëœ ì‹œê°„ì…ë‹ˆë‹¤!');
          return;
        }
        
        alarms.push(timeInput);
        saveToLocalStorage(); // ë¡œì»¬ ì €ì¥
        displayAlarms(); // í‘œì— í‘œì‹œ
        alert('ì„¤ì • ì™„ë£Œ');
        document.getElementById('alarmTime').value = ''; // ì…ë ¥ì°½ ì´ˆê¸°í™”
      } else {
        alert('ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
      }
    }

    // ì•ŒëŒ ì‚­ì œ í•¨ìˆ˜
    function deleteAlarm(index) {
      alarms.splice(index, 1); // ë°°ì—´ì—ì„œ ì œê±°
      saveToLocalStorage(); // ë¡œì»¬ ì €ì¥
      displayAlarms(); // í‘œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    }

    // ì•ŒëŒ í¸ì§‘ í•¨ìˆ˜
    function editAlarm(index) {
      editingIndex = index; // í¸ì§‘ ì¤‘ì¸ ì¸ë±ìŠ¤ ì €ì¥
      document.getElementById('editTimeInput').value = alarms[index]; // í˜„ì¬ ì‹œê°„ í‘œì‹œ
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('editModal').style.display = 'block';
    }

    // í¸ì§‘ ì €ì¥ í•¨ìˆ˜
    function saveEdit() {
      const newTime = document.getElementById('editTimeInput').value;
      
      if (newTime) {
        // ì¤‘ë³µ í™•ì¸ (ìê¸° ìì‹  ì œì™¸)
        if (alarms.includes(newTime) && alarms[editingIndex] !== newTime) {
          alert('ì´ë¯¸ ì„¤ì •ëœ ì‹œê°„ì…ë‹ˆë‹¤!');
          return;
        }
        
        alarms[editingIndex] = newTime; // ì‹œê°„ ìˆ˜ì •
        saveToLocalStorage(); // ë¡œì»¬ ì €ì¥
        displayAlarms(); // í‘œ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        cancelEdit(); // ëª¨ë‹¬ ë‹«ê¸°
        alert('ìˆ˜ì • ì™„ë£Œ');
      } else {
        alert('ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
      }
    }

    // í¸ì§‘ ì·¨ì†Œ í•¨ìˆ˜
    function cancelEdit() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('editModal').style.display = 'none';
      editingIndex = -1;
    }

    // í‘œì— ì•ŒëŒ ëª©ë¡ í‘œì‹œ
    function displayAlarms() {
      const list = document.getElementById('alarmList');
      
      if (alarms.length === 0) {
        list.innerHTML = '<tr><td colspan="3">ì„¤ì •ëœ ì•ŒëŒì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
      } else {
        list.innerHTML = alarms.map((alarm, index) => `
          <tr>
            <td>${alarm}</td>
            <td><button onclick="editAlarm(${index})">í¸ì§‘</button></td>
            <td><button onclick="deleteAlarm(${index})">ì‚­ì œ</button></td>
          </tr>
        `).join('');
      }
    }

    // ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
    function playAlarmSound() {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800; // ì†Œë¦¬ ë†’ì´
      oscillator.type = 'sine'; // ì†Œë¦¬ íŒŒí˜•
      
      // ì†Œë¦¬ í¬ê¸° ì¡°ì ˆ
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      
      oscillator.start();
      
      // ì†Œë¦¬ë¥¼ ê³„ì† ë°˜ë³µí•˜ê¸° ìœ„í•´ ë©ˆì¶”ê³  ë‹¤ì‹œ ì‹œì‘
      isAlarmRinging = true;
      repeatSound();
    }

    // ì†Œë¦¬ ë°˜ë³µ í•¨ìˆ˜
    function repeatSound() {
      if (isAlarmRinging) {
        setTimeout(() => {
          if (isAlarmRinging && oscillator) {
            oscillator.stop();
            playAlarmSound(); // ë‹¤ì‹œ ì¬ìƒ
          }
        }, 1000);
      }
    }

    // ì•ŒëŒ í‘œì‹œ í•¨ìˆ˜
    function showAlarm(alarmTime) {
      document.getElementById('alarmTimeText').textContent = `ì„¤ì • ì‹œê°„: ${alarmTime}`;
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('alarmModal').style.display = 'block';
      playAlarmSound();
    }

    // ì•ŒëŒ ë„ê¸° í•¨ìˆ˜
    function stopAlarm() {
      isAlarmRinging = false;
      
      // ì†Œë¦¬ ì •ì§€
      if (oscillator) {
        oscillator.stop();
        oscillator = null;
      }
      if (audioContext) {
        audioContext.close();
        audioContext = null;
      }
      
      // ëª¨ë‹¬ì°½ ìˆ¨ê¸°ê¸°
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('alarmModal').style.display = 'none';
    }

    // 1ì´ˆë§ˆë‹¤ í˜„ì¬ ì‹œê°„ í™•ì¸
    setInterval(() => {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      const seconds = now.getSeconds();
      const currentTime = hours.toString().padStart(2, '0') + ':' + 
                         minutes.toString().padStart(2, '0');

      // ì´ˆê°€ 0ì¼ ë•Œë§Œ í™•ì¸ (1ë¶„ì— í•œ ë²ˆë§Œ ì²´í¬)
      if (seconds === 0) {
        alarms.forEach((alarm, index) => {
          if (alarm === currentTime && !isAlarmRinging) {
            showAlarm(alarm);
            // ìš¸ë¦° ì•ŒëŒì€ ëª©ë¡ì—ì„œ ì œê±°
            deleteAlarm(index);
          }
        });
      }
    }, 1000);

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¹ˆ í‘œ í‘œì‹œ
    loadFromLocalStorage(); // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    displayAlarms();

    // ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
    function saveToLocalStorage() {
      localStorage.setItem('alarms', JSON.stringify(alarms));
    }

    // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadFromLocalStorage() {
      const saved = localStorage.getItem('alarms');
      if (saved) {
        alarms = JSON.parse(saved);
      }
    }

    // CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
    function exportToCSV() {
      if (alarms.length === 0) {
        alert('ì €ì¥í•  ì•ŒëŒì´ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }

      // CSV ë‚´ìš© ë§Œë“¤ê¸°
      let csvContent = "ì•ŒëŒì‹œê°„\n";
      alarms.forEach(alarm => {
        csvContent += alarm + "\n";
      });

      // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      const url = URL.createObjectURL(blob);
      
      link.setAttribute("href", url);
      link.setAttribute("download", "ì•ŒëŒëª©ë¡.csv");
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      alert('CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!');
    }

    // CSV íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    function importFromCSV(event) {
      const file = event.target.files[0];
      
      if (!file) {
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split('\n');
        
        // ì²« ì¤„(í—¤ë”) ì œì™¸í•˜ê³  ë°ì´í„° ì½ê¸°
        const newAlarms = [];
        for (let i = 1; i < lines.length; i++) {
          const time = lines[i].trim();
          // ì‹œê°„ í˜•ì‹ ê²€ì¦
          if (time && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(time)) {
            if (!alarms.includes(time) && !newAlarms.includes(time)) {
              newAlarms.push(time);
            }
          }
        }
        
        if (newAlarms.length > 0) {
          alarms = alarms.concat(newAlarms);
          saveToLocalStorage(); // ë¡œì»¬ ì €ì¥
          displayAlarms();
          alert(`${newAlarms.length}ê°œì˜ ì•ŒëŒì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!`);
        } else {
          alert('ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ” ì•ŒëŒì´ ì—†ìŠµë‹ˆë‹¤.');
        }
      };
      
      reader.readAsText(file);
      
      // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
      event.target.value = '';
    }
  </script>
</body>
</html>
